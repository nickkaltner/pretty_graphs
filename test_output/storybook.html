<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>PrettyGraphs Storybook</title>
    <style>
      :root {
        --bg: #0b0c0f;
        --panel: #111318;
        --muted: #c7c9d1;
        --text: #e7eaf2;
        --accent: #7c3aed;
      }
      * { box-sizing: border-box; }
      html, body { margin: 0; padding: 0; background: var(--bg); color: var(--text); font: 14px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; }
      .container { max-width: 1000px; margin: 0 auto; padding: 24px; }
      h1 { font-size: 28px; margin: 16px 0 24px; }
      h2 { font-size: 18px; margin: 24px 0 8px; color: var(--text); }
      .panel { background: var(--panel); border-radius: 10px; padding: 16px; margin: 16px 0 32px; box-shadow: 0 1px 2px rgba(0,0,0,0.3), 0 8px 24px rgba(0,0,0,0.2); }
      pre { margin: 0 0 12px; overflow: auto; }
      code { display: block; white-space: pre; color: var(--muted); }
      .chart { background: #0f1117; border-radius: 8px; padding: 8px; overflow: auto; }
      .chart svg { width: 100%; display: block; }
      .chart svg text { fill: #fff !important; }
      .controls { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px; margin: 12px 0 8px; }
      .control { display: flex; flex-direction: column; }
      .control.inline { flex-direction: row; align-items: center; gap: 8px; }
      .control label { font-weight: 600; margin-bottom: 4px; color: var(--text); }
      .control input[type="range"] { width: 100%; }
      .note { color: var(--muted); margin-top: 4px; }
      a { color: var(--accent); text-decoration: none; }
      a:hover { text-decoration: underline; }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>PrettyGraphs Storybook</h1>
      <div class="note">This page was generated by a test. Open <code>test_output/storybook.html</code> in a browser.</div>
<div class="panel"><h2>Interactive playground</h2><div class="controls"><div class="control"><label for="opt-gap">bar_gap (px): <span id="lbl-gap">2</span></label><input id="opt-gap" type="range" min="0" max="40" step="1" value="2"></div><div class="control"><label for="opt-bar-height">bar_height (px): <span id="lbl-bar-height">28</span></label><input id="opt-bar-height" type="range" min="10" max="60" step="1" value="28"></div><div class="control"><label for="opt-bar-radius">bar_radius (px): <span id="lbl-bar-radius">6</span></label><input id="opt-bar-radius" type="range" min="0" max="20" step="1" value="6"></div><div class="control"><label for="opt-title-gap">padding.top / title gap (px): <span id="lbl-title-gap">2</span></label><input id="opt-title-gap" type="range" min="0" max="100" step="1" value="2"></div><div class="control inline"><label><input type="checkbox" id="opt-use-gradient" checked> gradient.enabled</label></div><div class="control"><label for="opt-bar-color">bar_color: <span id="lbl-bar-color">#4f46e5</span></label><input id="opt-bar-color" type="color" value="#4f46e5"></div><div class="control"><label for="opt-grad-from">gradient.from: <span id="lbl-grad-from">#0ea5e9</span></label><input id="opt-grad-from" type="color" value="#0ea5e9"></div><div class="control"><label for="opt-grad-to">gradient.to: <span id="lbl-grad-to">#a78bfa</span></label><input id="opt-grad-to" type="color" value="#a78bfa"></div><div class="control"><label for="opt-grad-dir">gradient.direction: <span id="lbl-grad-dir">right</span></label><select id="opt-grad-dir"><option value="right">:right</option><option value="down">:down</option><option value="down_right">:down_right</option><option value="down_left">:down_left</option><option value="up_right">:up_right</option><option value="up_left">:up_left</option></select></div></div><div class="chart" id="interactive-chart"><svg xmlns="http://www.w3.org/2000/svg" width="640" height="144" viewBox="0 0 640 144" role="img" aria-label="Bar chart"><text x="120" y="28" text-anchor="start" dominant-baseline="alphabetic" fill="#111827" font-size="14" font-family="system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif" font-weight="600">Fruit Sales</text><text x="112" y="46" text-anchor="end" dominant-baseline="middle" fill="#111827" font-size="12" font-family="system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif" font-weight="400">Apples</text><rect x="120" y="32" width="188.8" height="28" rx="6" ry="6" fill="#4f46e5" /><text x="314.8" y="46" text-anchor="start" dominant-baseline="middle" fill="#111827" font-size="12" font-family="system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif" font-weight="400">10</text><text x="112" y="76" text-anchor="end" dominant-baseline="middle" fill="#111827" font-size="12" font-family="system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif" font-weight="400">Bananas</text><rect x="120" y="62" width="472.0" height="28" rx="6" ry="6" fill="#4f46e5" /><text x="598.0" y="76" text-anchor="start" dominant-baseline="middle" fill="#111827" font-size="12" font-family="system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif" font-weight="400">25</text><text x="112" y="106" text-anchor="end" dominant-baseline="middle" fill="#111827" font-size="12" font-family="system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif" font-weight="400">Cherries</text><rect x="120" y="92" width="339.84" height="28" rx="6" ry="6" fill="#4f46e5" /><text x="465.84" y="106" text-anchor="start" dominant-baseline="middle" fill="#111827" font-size="12" font-family="system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif" font-weight="400">18</text></svg></div><h3>Current configuration</h3><pre><code id="config-snippet"></code></pre><div class="note">Use the controls to tweak bar gap, bar height, corner radius, and gradient settings dynamically (client-side only for this storybook). The configuration block above shows the options you would pass to PrettyGraphs.bar_chart/2.</div></div><div class="panel"><h2>Basic: Horizontal rounded bars with title</h2><pre><code>data = [{&quot;Apples&quot;, 10}, {&quot;Bananas&quot;, 25}, {&quot;Cherries&quot;, 18}]
svg = PrettyGraphs.bar_chart(data, title: &quot;Fruit Sales&quot;)
</code></pre><div class="chart"><svg xmlns="http://www.w3.org/2000/svg" width="640" height="144" viewBox="0 0 640 144" role="img" aria-label="Bar chart"><text x="120" y="28" text-anchor="start" dominant-baseline="alphabetic" fill="#111827" font-size="14" font-family="system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif" font-weight="600">Fruit Sales</text><text x="112" y="46" text-anchor="end" dominant-baseline="middle" fill="#111827" font-size="12" font-family="system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif" font-weight="400">Apples</text><rect x="120" y="32" width="188.8" height="28" rx="6" ry="6" fill="#4f46e5" /><text x="314.8" y="46" text-anchor="start" dominant-baseline="middle" fill="#111827" font-size="12" font-family="system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif" font-weight="400">10</text><text x="112" y="76" text-anchor="end" dominant-baseline="middle" fill="#111827" font-size="12" font-family="system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif" font-weight="400">Bananas</text><rect x="120" y="62" width="472.0" height="28" rx="6" ry="6" fill="#4f46e5" /><text x="598.0" y="76" text-anchor="start" dominant-baseline="middle" fill="#111827" font-size="12" font-family="system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif" font-weight="400">25</text><text x="112" y="106" text-anchor="end" dominant-baseline="middle" fill="#111827" font-size="12" font-family="system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif" font-weight="400">Cherries</text><rect x="120" y="92" width="339.84" height="28" rx="6" ry="6" fill="#4f46e5" /><text x="465.84" y="106" text-anchor="start" dominant-baseline="middle" fill="#111827" font-size="12" font-family="system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif" font-weight="400">18</text></svg></div></div><div class="panel"><h2>Responsive width (fills parent container)</h2><pre><code># Make the SVG fill its container width via CSS.
# In this storybook we apply:
#   .chart svg { width: 100%; height: auto; }
#
# Or in LiveView/Tailwind you could wrap in a responsive container:
#   &lt;div class=&quot;w-full max-w-3xl&quot;&gt;&lt;%= Phoenix.HTML.raw(svg) %&gt;&lt;/div&gt;
#
# If the library supports it, you can also pass a responsive option:
#   svg = PrettyGraphs.bar_chart(data, title: &quot;Responsive width&quot;, responsive: true)
data = [{&quot;Apples&quot;, 10}, {&quot;Bananas&quot;, 25}, {&quot;Cherries&quot;, 18}]
svg = PrettyGraphs.bar_chart(data, title: &quot;Responsive width&quot;, responsive: true)
</code></pre><div class="chart"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="144" viewBox="0 0 640 144" role="img" aria-label="Bar chart" preserveAspectRatio="none"><text x="120" y="28" text-anchor="start" dominant-baseline="alphabetic" fill="#111827" font-size="14" font-family="system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif" font-weight="600">Responsive width</text><text x="112" y="46" text-anchor="end" dominant-baseline="middle" fill="#111827" font-size="12" font-family="system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif" font-weight="400">Apples</text><rect x="120" y="32" width="188.8" height="28" rx="6" ry="6" fill="#4f46e5" /><text x="314.8" y="46" text-anchor="start" dominant-baseline="middle" fill="#111827" font-size="12" font-family="system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif" font-weight="400">10</text><text x="112" y="76" text-anchor="end" dominant-baseline="middle" fill="#111827" font-size="12" font-family="system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif" font-weight="400">Bananas</text><rect x="120" y="62" width="472.0" height="28" rx="6" ry="6" fill="#4f46e5" /><text x="598.0" y="76" text-anchor="start" dominant-baseline="middle" fill="#111827" font-size="12" font-family="system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif" font-weight="400">25</text><text x="112" y="106" text-anchor="end" dominant-baseline="middle" fill="#111827" font-size="12" font-family="system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif" font-weight="400">Cherries</text><rect x="120" y="92" width="339.84" height="28" rx="6" ry="6" fill="#4f46e5" /><text x="465.84" y="106" text-anchor="start" dominant-baseline="middle" fill="#111827" font-size="12" font-family="system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif" font-weight="400">18</text></svg></div></div><div class="panel"><h2>Gradient: Diagonal (:down_right)</h2><pre><code>data = [{&quot;Apples&quot;, 10}, {&quot;Bananas&quot;, 25}, {&quot;Cherries&quot;, 18}]
svg = PrettyGraphs.bar_chart(
  data,
  title: &quot;Diagonal Gradient&quot;,
  gradient: [from: &quot;#0ea5e9&quot;, to: &quot;#a78bfa&quot;, direction: :down_right]
)
</code></pre><div class="chart"><svg xmlns="http://www.w3.org/2000/svg" width="640" height="144" viewBox="0 0 640 144" role="img" aria-label="Bar chart"><defs><linearGradient id="pg-grad" gradientUnits="userSpaceOnUse" x1="120" y1="32" x2="592" y2="120"><stop offset="0%" stop-color="#0ea5e9" /><stop offset="100%" stop-color="#a78bfa" /></linearGradient></defs><defs><clipPath id="pg-bars-clip" clipPathUnits="userSpaceOnUse"><rect x="120" y="32" width="188.8" height="28" rx="6" ry="6" fill="transparent" /><rect x="120" y="62" width="472.0" height="28" rx="6" ry="6" fill="transparent" /><rect x="120" y="92" width="339.84" height="28" rx="6" ry="6" fill="transparent" /></clipPath></defs><text x="120" y="28" text-anchor="start" dominant-baseline="alphabetic" fill="#111827" font-size="14" font-family="system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif" font-weight="600">Diagonal Gradient</text><g clip-path="url(#pg-bars-clip)"><rect x="120" y="32" width="472" height="88" rx="0" ry="0" fill="url(#pg-grad)" /></g><text x="112" y="46" text-anchor="end" dominant-baseline="middle" fill="#111827" font-size="12" font-family="system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif" font-weight="400">Apples</text><rect x="120" y="32" width="188.8" height="28" rx="6" ry="6" fill="transparent" /><text x="314.8" y="46" text-anchor="start" dominant-baseline="middle" fill="#111827" font-size="12" font-family="system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif" font-weight="400">10</text><text x="112" y="76" text-anchor="end" dominant-baseline="middle" fill="#111827" font-size="12" font-family="system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif" font-weight="400">Bananas</text><rect x="120" y="62" width="472.0" height="28" rx="6" ry="6" fill="transparent" /><text x="598.0" y="76" text-anchor="start" dominant-baseline="middle" fill="#111827" font-size="12" font-family="system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif" font-weight="400">25</text><text x="112" y="106" text-anchor="end" dominant-baseline="middle" fill="#111827" font-size="12" font-family="system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif" font-weight="400">Cherries</text><rect x="120" y="92" width="339.84" height="28" rx="6" ry="6" fill="transparent" /><text x="465.84" y="106" text-anchor="start" dominant-baseline="middle" fill="#111827" font-size="12" font-family="system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif" font-weight="400">18</text></svg></div></div><div class="panel"><h2>Phoenix integration: svg_attrs, svg_class, bar_attrs, bar_class</h2><pre><code>data = [{&quot;Apples&quot;, 10}, {&quot;Bananas&quot;, 25}, {&quot;Cherries&quot;, 18}]
svg =
  PrettyGraphs.bar_chart(
    data,
    title: &quot;Phoenix attrs on svg + bars&quot;,
    svg_attrs: %{&quot;phx-hook&quot; =&gt; &quot;Chart&quot;},
    svg_class: [&quot;w-full&quot;, &quot;h-auto&quot;],
    bar_attrs: [data_role: &quot;bar&quot;, %{&quot;phx-click&quot; =&gt; &quot;bar_clicked&quot;}],
    bar_class: [&quot;cursor-pointer&quot;, &quot;hover:opacity-80&quot;],
    gradient: [from: &quot;#4f46e5&quot;, to: &quot;#a78bfa&quot;, direction: :right]
  )
</code></pre><div class="chart"><svg xmlns="http://www.w3.org/2000/svg" width="640" height="144" viewBox="0 0 640 144" role="img" aria-label="Bar chart" class="w-full h-auto" phx-hook="Chart"><defs><linearGradient id="pg-grad" gradientUnits="userSpaceOnUse" x1="120" y1="32" x2="592" y2="32"><stop offset="0%" stop-color="#4f46e5" /><stop offset="100%" stop-color="#a78bfa" /></linearGradient></defs><defs><clipPath id="pg-bars-clip" clipPathUnits="userSpaceOnUse"><rect x="120" y="32" width="188.8" height="28" rx="6" ry="6" fill="transparent" /><rect x="120" y="62" width="472.0" height="28" rx="6" ry="6" fill="transparent" /><rect x="120" y="92" width="339.84" height="28" rx="6" ry="6" fill="transparent" /></clipPath></defs><text x="120" y="28" text-anchor="start" dominant-baseline="alphabetic" fill="#111827" font-size="14" font-family="system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif" font-weight="600">Phoenix attrs on svg + bars</text><g clip-path="url(#pg-bars-clip)"><rect x="120" y="32" width="472" height="88" rx="0" ry="0" fill="url(#pg-grad)" /></g><text x="112" y="46" text-anchor="end" dominant-baseline="middle" fill="#111827" font-size="12" font-family="system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif" font-weight="400">Apples</text><rect x="120" y="32" width="188.8" height="28" rx="6" ry="6" fill="transparent" class="cursor-pointer hover:opacity-80" data_role="bar" phx-click="bar_clicked" /><text x="314.8" y="46" text-anchor="start" dominant-baseline="middle" fill="#111827" font-size="12" font-family="system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif" font-weight="400">10</text><text x="112" y="76" text-anchor="end" dominant-baseline="middle" fill="#111827" font-size="12" font-family="system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif" font-weight="400">Bananas</text><rect x="120" y="62" width="472.0" height="28" rx="6" ry="6" fill="transparent" class="cursor-pointer hover:opacity-80" data_role="bar" phx-click="bar_clicked" /><text x="598.0" y="76" text-anchor="start" dominant-baseline="middle" fill="#111827" font-size="12" font-family="system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif" font-weight="400">25</text><text x="112" y="106" text-anchor="end" dominant-baseline="middle" fill="#111827" font-size="12" font-family="system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif" font-weight="400">Cherries</text><rect x="120" y="92" width="339.84" height="28" rx="6" ry="6" fill="transparent" class="cursor-pointer hover:opacity-80" data_role="bar" phx-click="bar_clicked" /><text x="465.84" y="106" text-anchor="start" dominant-baseline="middle" fill="#111827" font-size="12" font-family="system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif" font-weight="400">18</text></svg></div></div><div class="panel"><h2>Per-data-point attrs + global click handler</h2><pre><code>data = [
  {&quot;Apples&quot;, 10, [attrs: %{&quot;phx-value-fruit&quot; =&gt; &quot;apples&quot;}]},
  {&quot;Bananas&quot;, 25, [attrs: %{&quot;phx-value-fruit&quot; =&gt; &quot;bananas&quot;}]},
  {&quot;Cherries&quot;, 18, [attrs: %{&quot;phx-value-fruit&quot; =&gt; &quot;cherries&quot;}]}
]

svg =
  PrettyGraphs.bar_chart(
    data,
    title: &quot;Per-point attrs (phx-value-*) + global phx-click&quot;,
    bar_attrs: [%{&quot;phx-click&quot; =&gt; &quot;bar_clicked&quot;}],
    bar_class: &quot;cursor-pointer hover:opacity-80&quot;,
    gradient: [from: &quot;#0ea5e9&quot;, to: &quot;#a78bfa&quot;, direction: :down_left]
  )
</code></pre><div class="chart"><svg xmlns="http://www.w3.org/2000/svg" width="640" height="144" viewBox="0 0 640 144" role="img" aria-label="Bar chart"><defs><linearGradient id="pg-grad" gradientUnits="userSpaceOnUse" x1="592" y1="32" x2="120" y2="120"><stop offset="0%" stop-color="#0ea5e9" /><stop offset="100%" stop-color="#a78bfa" /></linearGradient></defs><defs><clipPath id="pg-bars-clip" clipPathUnits="userSpaceOnUse"><rect x="120" y="32" width="188.8" height="28" rx="6" ry="6" fill="transparent" /><rect x="120" y="62" width="472.0" height="28" rx="6" ry="6" fill="transparent" /><rect x="120" y="92" width="339.84" height="28" rx="6" ry="6" fill="transparent" /></clipPath></defs><text x="120" y="28" text-anchor="start" dominant-baseline="alphabetic" fill="#111827" font-size="14" font-family="system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif" font-weight="600">Per-point attrs (phx-value-*) + global phx-click</text><g clip-path="url(#pg-bars-clip)"><rect x="120" y="32" width="472" height="88" rx="0" ry="0" fill="url(#pg-grad)" /></g><text x="112" y="46" text-anchor="end" dominant-baseline="middle" fill="#111827" font-size="12" font-family="system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif" font-weight="400">Apples</text><rect x="120" y="32" width="188.8" height="28" rx="6" ry="6" fill="transparent" class="cursor-pointer hover:opacity-80" phx-click="bar_clicked" phx-value-fruit="apples" /><text x="314.8" y="46" text-anchor="start" dominant-baseline="middle" fill="#111827" font-size="12" font-family="system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif" font-weight="400">10</text><text x="112" y="76" text-anchor="end" dominant-baseline="middle" fill="#111827" font-size="12" font-family="system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif" font-weight="400">Bananas</text><rect x="120" y="62" width="472.0" height="28" rx="6" ry="6" fill="transparent" class="cursor-pointer hover:opacity-80" phx-click="bar_clicked" phx-value-fruit="bananas" /><text x="598.0" y="76" text-anchor="start" dominant-baseline="middle" fill="#111827" font-size="12" font-family="system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif" font-weight="400">25</text><text x="112" y="106" text-anchor="end" dominant-baseline="middle" fill="#111827" font-size="12" font-family="system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif" font-weight="400">Cherries</text><rect x="120" y="92" width="339.84" height="28" rx="6" ry="6" fill="transparent" class="cursor-pointer hover:opacity-80" phx-click="bar_clicked" phx-value-fruit="cherries" /><text x="465.84" y="106" text-anchor="start" dominant-baseline="middle" fill="#111827" font-size="12" font-family="system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif" font-weight="400">18</text></svg></div></div><div class="panel"><h2>Map data shape (with per-point attrs/class)</h2><pre><code>data = %{
  &quot;Apples&quot; =&gt; {10, [attrs: %{&quot;phx-value-fruit&quot; =&gt; &quot;apples&quot;}, class: &quot;fill-lime-600&quot;]},
  &quot;Bananas&quot; =&gt; {25, [attrs: %{&quot;phx-value-fruit&quot; =&gt; &quot;bananas&quot;}]},
  &quot;Cherries&quot; =&gt; {18, [attrs: %{&quot;phx-value-fruit&quot; =&gt; &quot;cherries&quot;}]}
}

svg =
  PrettyGraphs.bar_chart(
    data,
    title: &quot;Map shape with per-point attrs/classes&quot;,
    bar_attrs: [%{&quot;phx-click&quot; =&gt; &quot;bar_clicked&quot;}],
    bar_class: &quot;cursor-pointer hover:opacity-80&quot;,
    gradient: [from: &quot;#0ea5e9&quot;, to: &quot;#a78bfa&quot;, direction: :up_right]
  )
</code></pre><div class="chart"><svg xmlns="http://www.w3.org/2000/svg" width="640" height="144" viewBox="0 0 640 144" role="img" aria-label="Bar chart"><defs><linearGradient id="pg-grad" gradientUnits="userSpaceOnUse" x1="120" y1="120" x2="592" y2="32"><stop offset="0%" stop-color="#0ea5e9" /><stop offset="100%" stop-color="#a78bfa" /></linearGradient></defs><defs><clipPath id="pg-bars-clip" clipPathUnits="userSpaceOnUse"><rect x="120" y="32" width="188.8" height="28" rx="6" ry="6" fill="transparent" /><rect x="120" y="62" width="472.0" height="28" rx="6" ry="6" fill="transparent" /><rect x="120" y="92" width="339.84" height="28" rx="6" ry="6" fill="transparent" /></clipPath></defs><text x="120" y="28" text-anchor="start" dominant-baseline="alphabetic" fill="#111827" font-size="14" font-family="system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif" font-weight="600">Map shape with per-point attrs/classes</text><g clip-path="url(#pg-bars-clip)"><rect x="120" y="32" width="472" height="88" rx="0" ry="0" fill="url(#pg-grad)" /></g><text x="112" y="46" text-anchor="end" dominant-baseline="middle" fill="#111827" font-size="12" font-family="system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif" font-weight="400">Apples</text><rect x="120" y="32" width="188.8" height="28" rx="6" ry="6" fill="transparent" class="cursor-pointer hover:opacity-80 fill-lime-600" phx-click="bar_clicked" phx-value-fruit="apples" /><text x="314.8" y="46" text-anchor="start" dominant-baseline="middle" fill="#111827" font-size="12" font-family="system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif" font-weight="400">10</text><text x="112" y="76" text-anchor="end" dominant-baseline="middle" fill="#111827" font-size="12" font-family="system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif" font-weight="400">Bananas</text><rect x="120" y="62" width="472.0" height="28" rx="6" ry="6" fill="transparent" class="cursor-pointer hover:opacity-80" phx-click="bar_clicked" phx-value-fruit="bananas" /><text x="598.0" y="76" text-anchor="start" dominant-baseline="middle" fill="#111827" font-size="12" font-family="system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif" font-weight="400">25</text><text x="112" y="106" text-anchor="end" dominant-baseline="middle" fill="#111827" font-size="12" font-family="system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif" font-weight="400">Cherries</text><rect x="120" y="92" width="339.84" height="28" rx="6" ry="6" fill="transparent" class="cursor-pointer hover:opacity-80" phx-click="bar_clicked" phx-value-fruit="cherries" /><text x="465.84" y="106" text-anchor="start" dominant-baseline="middle" fill="#111827" font-size="12" font-family="system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif" font-weight="400">18</text></svg></div></div><div class="panel"><h2>Numbers-only data with defaults</h2><pre><code>data = [10, 25, 18]
svg =
  PrettyGraphs.bar_chart(
    data,
    title: &quot;Numbers list (auto labels 1..n)&quot;,
    gradient: [from: &quot;#4f46e5&quot;, to: &quot;#a78bfa&quot;, direction: :down]
  )
</code></pre><div class="chart"><svg xmlns="http://www.w3.org/2000/svg" width="640" height="144" viewBox="0 0 640 144" role="img" aria-label="Bar chart"><defs><linearGradient id="pg-grad" gradientUnits="userSpaceOnUse" x1="120" y1="32" x2="120" y2="120"><stop offset="0%" stop-color="#4f46e5" /><stop offset="100%" stop-color="#a78bfa" /></linearGradient></defs><defs><clipPath id="pg-bars-clip" clipPathUnits="userSpaceOnUse"><rect x="120" y="32" width="188.8" height="28" rx="6" ry="6" fill="transparent" /><rect x="120" y="62" width="472.0" height="28" rx="6" ry="6" fill="transparent" /><rect x="120" y="92" width="339.84" height="28" rx="6" ry="6" fill="transparent" /></clipPath></defs><text x="120" y="28" text-anchor="start" dominant-baseline="alphabetic" fill="#111827" font-size="14" font-family="system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif" font-weight="600">Numbers list (auto labels 1..n)</text><g clip-path="url(#pg-bars-clip)"><rect x="120" y="32" width="472" height="88" rx="0" ry="0" fill="url(#pg-grad)" /></g><text x="112" y="46" text-anchor="end" dominant-baseline="middle" fill="#111827" font-size="12" font-family="system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif" font-weight="400">1</text><rect x="120" y="32" width="188.8" height="28" rx="6" ry="6" fill="transparent" /><text x="314.8" y="46" text-anchor="start" dominant-baseline="middle" fill="#111827" font-size="12" font-family="system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif" font-weight="400">10</text><text x="112" y="76" text-anchor="end" dominant-baseline="middle" fill="#111827" font-size="12" font-family="system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif" font-weight="400">2</text><rect x="120" y="62" width="472.0" height="28" rx="6" ry="6" fill="transparent" /><text x="598.0" y="76" text-anchor="start" dominant-baseline="middle" fill="#111827" font-size="12" font-family="system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif" font-weight="400">25</text><text x="112" y="106" text-anchor="end" dominant-baseline="middle" fill="#111827" font-size="12" font-family="system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif" font-weight="400">3</text><rect x="120" y="92" width="339.84" height="28" rx="6" ry="6" fill="transparent" /><text x="465.84" y="106" text-anchor="start" dominant-baseline="middle" fill="#111827" font-size="12" font-family="system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif" font-weight="400">18</text></svg></div></div>    <script>
    document.addEventListener('DOMContentLoaded', function () {
      const container = document.getElementById('interactive-chart');
      if (!container) return;
      const svg = container.querySelector('svg');
      if (!svg) return;

      const rects = Array.from(svg.querySelectorAll('rect'))
        .filter(r => parseFloat(r.getAttribute('height') || '0') > 0);

      if (rects.length === 0) return;

      let barHeight = parseFloat(rects[0].getAttribute('height'));
      const ys = rects.map(r => parseFloat(r.getAttribute('y')));
      let firstY = ys[0];
      const origGap = ys.length > 1 ? (ys[1] - ys[0] - barHeight) : 2;

      function textsAtY(targetY) {
        const mid = targetY + barHeight / 2;
        const all = Array.from(svg.querySelectorAll('text'));
        return all.filter(t => {
          const y = parseFloat(t.getAttribute('y') || '0');
          return Math.abs(y - mid) < 0.1 && t.textContent.trim() !== 'No data';
        });
      }

      const barRows = rects.map(r => {
        const y = parseFloat(r.getAttribute('y'));
        return { rect: r, texts: textsAtY(y) };
      });

      const gapInput = document.getElementById('opt-gap');
      const barColorInput = document.getElementById('opt-bar-color');
      const gradFromInput = document.getElementById('opt-grad-from');
      const gradToInput = document.getElementById('opt-grad-to');
      const useGradInput = document.getElementById('opt-use-gradient');
      const gradDirSelect = document.getElementById('opt-grad-dir');
      const barHeightInput = document.getElementById('opt-bar-height');
      const barRadiusInput = document.getElementById('opt-bar-radius');
      const titleGapInput = document.getElementById('opt-title-gap');
      const configCodeEl = document.getElementById('config-snippet');

      const gapLabel = document.getElementById('lbl-gap');
      const barColorLabel = document.getElementById('lbl-bar-color');
      const gradFromLabel = document.getElementById('lbl-grad-from');
      const gradToLabel = document.getElementById('lbl-grad-to');
      const gradDirLabel = document.getElementById('lbl-grad-dir');
      const barHeightLabel = document.getElementById('lbl-bar-height');
      const barRadiusLabel = document.getElementById('lbl-bar-radius');
      const titleGapLabel = document.getElementById('lbl-title-gap');

      const allTextNodes = Array.from(svg.querySelectorAll('text'));
      const titleEl = allTextNodes.sort((a,b) => parseFloat(a.getAttribute('y')||'0') - parseFloat(b.getAttribute('y')||'0'))[0];
      let titleY = titleEl ? parseFloat(titleEl.getAttribute('y') || '0') : 0;
      let titleGap = firstY - titleY;

      function ensureGradient() {
        let defs = svg.querySelector('defs');
        if (!defs) {
          defs = document.createElementNS('http://www.w3.org/2000/svg', 'defs');
          svg.insertBefore(defs, svg.firstChild);
        }
        let grad = svg.querySelector('#pg-grad');
        if (!grad) {
          grad = document.createElementNS('http://www.w3.org/2000/svg', 'linearGradient');
          grad.setAttribute('id', 'pg-grad');
          grad.setAttribute('gradientUnits', 'userSpaceOnUse');
          // Initial coordinates will be set by setGradientDirection
          defs.appendChild(grad);
          const s1 = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
          s1.setAttribute('offset', '0%'); grad.appendChild(s1);
          const s2 = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
          s2.setAttribute('offset', '100%'); grad.appendChild(s2);
        } else {
          grad.setAttribute('gradientUnits', 'userSpaceOnUse');
        }
        return grad;
      }

      function setGradientColors(from, to) {
        const grad = ensureGradient();
        const stops = grad.querySelectorAll('stop');
        if (stops[0]) stops[0].setAttribute('stop-color', from);
        if (stops[1]) stops[1].setAttribute('stop-color', to);
      }

      function setGradientDirection(dir) {
        const grad = ensureGradient();
        // Compute bars bounding box to align gradient across all bars (userSpaceOnUse)
        const left = Math.min(...rects.map(r => parseFloat(r.getAttribute('x') || '0')));
        const right = Math.max(...rects.map(r => parseFloat(r.getAttribute('x') || '0') + parseFloat(r.getAttribute('width') || '0')));
        const top = Math.min(...rects.map(r => parseFloat(r.getAttribute('y') || '0')));
        const gap = parseFloat(gapInput && gapInput.value || '2');
        const h = barRows.length * barHeight + (barRows.length > 1 ? (barRows.length - 1) * gap : 0);
        const bottom = top + h;
        const map = {
          down: [left, top, left, bottom],
          right: [left, top, right, top],
          down_right: [left, top, right, bottom],
          down_left: [right, top, left, bottom],
          up_right: [left, bottom, right, top],
          up_left: [right, bottom, left, top]
        };
        const v = map[dir] || map.right;
        grad.setAttribute('x1', v[0]); grad.setAttribute('y1', v[1]);
        grad.setAttribute('x2', v[2]); grad.setAttribute('y2', v[3]);
      }

      function rgbToHex(c) {
        if (!c) return '#4f46e5';
        const ctx = document.createElement('canvas').getContext('2d');
        ctx.fillStyle = c;
        return ctx.fillStyle.startsWith('#') ? ctx.fillStyle : '#4f46e5';
      }

      function applyFill() {
        const ns = 'http://www.w3.org/2000/svg';
        if (useGradInput.checked) {
          setGradientColors(gradFromInput.value, gradToInput.value);
          setGradientDirection(gradDirSelect ? gradDirSelect.value : 'right');
          // Ensure/refresh clipPath that unions all bars
          let defs = svg.querySelector('defs');
          if (!defs) {
            defs = document.createElementNS(ns, 'defs');
            svg.insertBefore(defs, svg.firstChild);
          }
          let clip = svg.querySelector('#pg-bars-clip');
          if (!clip) {
            clip = document.createElementNS(ns, 'clipPath');
            clip.setAttribute('id', 'pg-bars-clip');
            clip.setAttribute('clipPathUnits', 'userSpaceOnUse');
            defs.appendChild(clip);
          }
          // Rebuild clipPath rects
          while (clip.firstChild) clip.removeChild(clip.firstChild);
          rects.forEach(r => {
            const cr = document.createElementNS(ns, 'rect');
            cr.setAttribute('x', r.getAttribute('x'));
            cr.setAttribute('y', r.getAttribute('y'));
            cr.setAttribute('width', r.getAttribute('width'));
            cr.setAttribute('height', r.getAttribute('height'));
            cr.setAttribute('rx', r.getAttribute('rx') || '0');
            cr.setAttribute('ry', r.getAttribute('ry') || '0');
            clip.appendChild(cr);
            // Make bars transparent so gradient backdrop shows through
            r.setAttribute('fill', 'transparent');
          });
          // Ensure gradient backdrop layer
          let layer = svg.querySelector('#pg-grad-layer');
          if (!layer) {
            layer = document.createElementNS(ns, 'g');
            layer.setAttribute('id', 'pg-grad-layer');
            svg.insertBefore(layer, svg.firstChild.nextSibling); // after defs
          }
          layer.setAttribute('clip-path', 'url(#pg-bars-clip)');
          let back = svg.querySelector('#pg-grad-backdrop');
          if (!back) {
            back = document.createElementNS(ns, 'rect');
            back.setAttribute('id', 'pg-grad-backdrop');
            layer.appendChild(back);
          }
          // Compute bars bbox for backdrop size
          const left = Math.min(...rects.map(r => parseFloat(r.getAttribute('x') || '0')));
          const right = Math.max(...rects.map(r => parseFloat(r.getAttribute('x') || '0') + parseFloat(r.getAttribute('width') || '0')));
          const top = Math.min(...rects.map(r => parseFloat(r.getAttribute('y') || '0')));
          const gap = parseFloat(gapInput && gapInput.value || '2');
          const h = barRows.length * barHeight + (barRows.length > 1 ? (barRows.length - 1) * gap : 0);
          back.setAttribute('x', String(left));
          back.setAttribute('y', String(top));
          back.setAttribute('width', String(Math.max(0, right - left)));
          back.setAttribute('height', String(h));
          back.setAttribute('fill', 'url(#pg-grad)');
          if (gradFromLabel) gradFromLabel.textContent = gradFromInput.value;
          if (gradToLabel) gradToLabel.textContent = gradToInput.value;
          if (gradDirLabel && gradDirSelect) gradDirLabel.textContent = gradDirSelect.value;
        } else {
          // Remove gradient layer and restore solid bar fills
          const layer = svg.querySelector('#pg-grad-layer');
          if (layer) layer.remove();
          barRows.forEach(row => row.rect.setAttribute('fill', barColorInput.value));
          if (barColorLabel) barColorLabel.textContent = barColorInput.value;
        }
      }

      function applyGap() {
        const gap = parseFloat(gapInput.value || '2');
        barRows.forEach((row, i) => {
          const y = firstY + i * (barHeight + gap);
          row.rect.setAttribute('y', y);
          const mid = y + barHeight / 2;
          row.texts.forEach(t => t.setAttribute('y', mid));
        });
        if (useGradInput.checked) {
          // Update clip rects and backdrop geometry to match new positions
          applyFill(); // reuses logic to rebuild clip + backdrop and keep gradient aligned
        }
        if (gapLabel) gapLabel.textContent = String(gap);
        updateConfigSnippet();
      }

      function applyBarHeight() {
        const val = parseFloat(barHeightInput && barHeightInput.value || String(barHeight));
        if (!isNaN(val) && val > 0) {
          barHeight = val;
          rects.forEach(r => r.setAttribute('height', barHeight));
          if (barHeightLabel) barHeightLabel.textContent = String(Math.round(barHeight));
          applyGap();
          updateConfigSnippet();
        }
      }

      function applyBarRadius() {
        const r = parseFloat(barRadiusInput && barRadiusInput.value || '0');
        if (!isNaN(r) && r >= 0) {
          rects.forEach(rect => {
            rect.setAttribute('rx', r);
            rect.setAttribute('ry', r);
          });
          if (useGradInput.checked) {
            // Rebuild clipPath with new radii and ensure backdrop remains sized correctly
            applyFill();
          }
          if (barRadiusLabel) barRadiusLabel.textContent = String(Math.round(r));
          updateConfigSnippet();
        }
      }

      function applyTitleGap() {
        const desired = parseFloat(titleGapInput && titleGapInput.value || String(titleGap));
        if (!isNaN(desired)) {
          const delta = desired - (firstY - titleY);
          firstY = firstY + delta;
          titleGap = desired;
          if (titleGapLabel) titleGapLabel.textContent = String(Math.round(titleGap));
          applyGap();
          updateConfigSnippet();
        }
      }

      function updateConfigSnippet() {
        if (!configCodeEl) return;
        const gap = parseFloat(gapInput && gapInput.value || '2') || 2;
        const r = parseFloat(barRadiusInput && barRadiusInput.value || rects[0].getAttribute('rx') || '6') || 6;
        const bh = parseFloat(barHeightInput && barHeightInput.value || String(barHeight)) || barHeight;
        const dir = (gradDirSelect && gradDirSelect.value) || 'right';
        const usingGrad = !!(useGradInput && useGradInput.checked);
        const topPad = Math.round(firstY);

        let parts = [];
        parts.push('title: "Fruit Sales"');
        parts.push('bar_gap: ' + gap);
        parts.push('bar_height: ' + bh);
        parts.push('bar_radius: ' + r);
        parts.push('padding: [top: ' + topPad + ']');

        if (usingGrad) {
          parts.push('gradient: [from: "' + (gradFromInput ? gradFromInput.value : '#0ea5e9') +
            '", to: "' + (gradToInput ? gradToInput.value : '#a78bfa') +
            '", direction: :' + dir + ']');
        } else if (barColorInput) {
          parts.push('bar_color: "' + barColorInput.value + '"');
        }

        const snippet = [
          "svg = PrettyGraphs.bar_chart(data,",
          "  " + parts.join(",\n  "),
          ")"
        ].join("\n");
        configCodeEl.textContent = snippet;
      }

      gapInput && gapInput.addEventListener('input', applyGap);
      barHeightInput && barHeightInput.addEventListener('input', applyBarHeight);
      barRadiusInput && barRadiusInput.addEventListener('input', applyBarRadius);
      titleGapInput && titleGapInput.addEventListener('input', applyTitleGap);
      barColorInput && barColorInput.addEventListener('input', function(){ applyFill(); updateConfigSnippet(); });
      gradFromInput && gradFromInput.addEventListener('input', function(){ applyFill(); updateConfigSnippet(); });
      gradToInput && gradToInput.addEventListener('input', function(){ applyFill(); updateConfigSnippet(); });
      useGradInput && useGradInput.addEventListener('change', function(){ applyFill(); updateConfigSnippet(); });
      gradDirSelect && gradDirSelect.addEventListener('change', function(){ applyFill(); updateConfigSnippet(); });

      (function initControls() {
        if (gapInput) {
          gapInput.value = Math.max(0, Math.min(40, Math.round(origGap)));
          if (gapLabel) gapLabel.textContent = String(Math.round(origGap));
        }
        if (barHeightInput) {
          if (barHeightLabel) barHeightLabel.textContent = String(Math.round(barHeight));
        }
        if (barRadiusInput) {
          const r0 = parseFloat(rects[0].getAttribute('rx') || '6') || 6;
          barRadiusInput.value = r0;
          if (barRadiusLabel) barRadiusLabel.textContent = String(Math.round(r0));
        }
        if (titleGapInput) {
          titleGapInput.value = Math.max(0, Math.round(titleGap));
          if (titleGapLabel) titleGapLabel.textContent = String(Math.round(titleGap));
        }
        const firstFill = rects[0].getAttribute('fill') || '';
        if (useGradInput) useGradInput.checked = firstFill.indexOf('url(') === 0;
        if (gradDirSelect) gradDirSelect.value = 'right';

        const g = svg.querySelector('#pg-grad');
        if (g) {
          const stops = g.querySelectorAll('stop');
          if (stops[0] && gradFromInput) gradFromInput.value = rgbToHex(stops[0].getAttribute('stop-color') || gradFromInput.value);
          if (stops[1] && gradToInput) gradToInput.value = rgbToHex(stops[1].getAttribute('stop-color') || gradToInput.value);
        }
        if (!useGradInput || !useGradInput.checked) {
          if (barColorInput) barColorInput.value = rgbToHex(firstFill || barColorInput.value);
        }
        applyFill();
        applyGap();
        updateConfigSnippet();
      })();
    });
    </script>
    </div>
  </body>
</html>
